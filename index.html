<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="../savaka-style.css">
	<title>JoshieScript Online - Savaka's GitHub Page</title>
	<script src="../templategenerator.js"></script>
	<script>
		var tg = {
			levels: 1,
			sitename: 'JoshieScript Online',
			repo: 'joshiescript-online',
			home: true
		}
	</script>
	<script>
		var mem = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
		function resetmem() {
			mem = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
		};
		function go(num) {
			var textfield = document.getElementById('in');
			var form = document.getElementById('forms');
			form.style.display = 'none';
			if (num == 1) {
				var script = importt(textfield.value);
				textfield.value = '';
				resetmem();
				parse(script);
			}
		};
		function importt(text) {
			res = text.split(';');
			res.splice(res.length - 1, 1);
			return res;
		};
		function sleep(time) {
			var currentTime = new Date().getTime();
			while (currentTime + time >= new Date().getTime()) {
				
			}
		}
		function parse(code) {
			var tmp = [];
			var temp = '';
			var temp2 = '';
			looping: {
				for (i = 0; i < code.length; i++) {
					switch (code[i]) {
						case 'out':
							i++;
							if (code[i][0] == '"') {
								log(code[i].substring(1, code[i].length - 1));
							} else {
								log(mem[code[i]-1]);
							}
							break;
						case 'add':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							if (tmp[0][0] == '/') {
								temp = tmp[0].substring(1);
								temp = mem[temp-1];
							} else {
								temp = tmp[0];
							}
							if (tmp[1][0] == '/') {
								temp2 = tmp[1].substring(1);
								temp2 = mem[temp2-1];
							} else {
								temp2 = tmp[1];
							}
							mem[tmp[2]-1] = temp + temp2;
							break;
						case 'sub':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							if (tmp[0][0] == '/') {
								temp = tmp[0].substring(1);
								temp = mem[temp-1];
							} else {
								temp = tmp[0];
							}
							if (tmp[1][0] == '/') {
								temp2 = tmp[1].substring(1);
								temp2 = mem[temp2-1];
							} else {
								temp2 = tmp[1];
							}
							mem[tmp[2]-1] = temp - temp2;
							break;
						case 'mult':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							if (tmp[0][0] == '/') {
								temp = tmp[0].substring(1);
								temp = mem[temp-1];
							} else {
								temp = tmp[0];
							}
							if (tmp[1][0] == '/') {
								temp2 = tmp[1].substring(1);
								temp2 = mem[temp2-1];
							} else {
								temp2 = tmp[1];
							}
							mem[tmp[2]-1] = temp * temp2;
							break;
						case 'div':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							if (tmp[0][0] == '/') {
								temp = tmp[0].substring(1);
								temp = mem[temp-1];
							} else {
								temp = tmp[0];
							}
							if (tmp[1][0] == '/') {
								temp2 = tmp[1].substring(1);
								temp2 = mem[temp2-1];
							} else {
								temp2 = tmp[1];
							}
							mem[tmp[2]-1] = temp / temp2;
							break;
						case 'mov':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							mem[tmp[0]-1] = mem[tmp[1]-1];
							break;
						case 'set':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							mem[tmp[0]-1] = tmp[1];
							break;
						case 'jump':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i = tmp[0];
							break;
						case 'input':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							mem[tmp[1]-1] = prompt(tmp[0]);
							break;
						case 'wait':
							tmp = [];
							i++;
							sleep(code[i].parseInt()*1000);
							//error('wait is not supported');
							break;
						case 'if':
							tmp = [];
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							i++;
							tmp.push(code[i]);
							if (tmp[0][0] == '/') {
								temp = tmp[0].substring(1);
								temp = mem[temp-1];
							} else {
								temp = tmp[0];
							}
							if (tmp[2][0] == '/') {
								temp2 = tmp[2].substring(1);
								temp2 = mem[temp2-1];
							} else {
								temp2 = tmp[2];
							}
							switch (tmp[1]) {
								case '=':
									if (!(temp == temp2)) {
										while (!(code[i] == 'end')) {
											i++;
										}
									}
									break;
								case '>':
									if (!(temp > temp2)) {
										while (!(code[i] == 'end')) {
											i++;
										}
									}
									break;
								case '<':
									if (!(temp == temp2)) {
										while (!(code[i] == 'end')) {
											i++;
										}
									}
									break;
								default:
									error('[IF] Syntax error');
									break looping;
							}
						case 'end':
							break;
						case '':
							break;
						default:
							error('Syntax error');
							break looping;
					}
				}
			}
		};
		function log(text) {
			document.getElementById('console').innerHTML += '<br/>' + text.toString();
		};
		function error(text) {
			console.log(text);
		};
	</script>
</head>
<body>
	<main>
	<h1>JoshieScript Online</h1>
	<p><!-- description --></p>
	<p>wait is not supported, sorry</p>
	<p>Reload the page if you want to use it again</p>
	<div id="forms"><input type="text" id="in" placeholder="Paste exported code"><button onclick="go(1);">Submit</button></div>
	<div id="console" style="font-family:monospace"></div>
	</main>
</body>
</html>
